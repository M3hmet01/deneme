/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include "i2c-lcd.h"  // LCD Kütüphanesi
#include <stdio.h>    // sprintf için
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */

/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/
ADC_HandleTypeDef hadc1;
I2C_HandleTypeDef hi2c1;
TIM_HandleTypeDef htim2;

/* USER CODE BEGIN PV */
// LCD için İsim Dizileri
char* CoffeeNames[] = {
    "Bos",
    "Turk Kahvesi",
    "Espresso",
    "Ristretto",
    "Lungo",
    "Americano",
    "Latte",
    "Caramel Latte",
    "Cappuccino",
    "Mocha"
};

char* LevelNames[] = {
    "AZ  ",
    "ORTA",
    "COK "
};
/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_ADC1_Init(void);
static void MX_TIM2_Init(void);
static void MX_I2C1_Init(void);
/* USER CODE BEGIN PFP */

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */

uint8_t currentTemp;
uint32_t ledTimer       = 0		;
uint8_t CoffyGramBit    = 0x00  ;
uint16_t WaterMilimBit  = 0x00  ;
uint16_t MilkMilimBit   = 0x00  ;

int Keyboard_Read(void)
{
    // -------- ROW 1 --------
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0, GPIO_PIN_SET);
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_1|GPIO_PIN_2|GPIO_PIN_3, GPIO_PIN_RESET);
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0)) return 1;
    if (HAL_GPIO_ReadPin(GPIOE, GPIO_PIN_11)) return 2;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_2)) return 3;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_3)) return 'A';

    // -------- ROW 2 --------
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_1, GPIO_PIN_SET);
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0|GPIO_PIN_2|GPIO_PIN_3, GPIO_PIN_RESET);
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0)) return 4;
    if (HAL_GPIO_ReadPin(GPIOE, GPIO_PIN_11)) return 5;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_2)) return 6;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_3)) return 'B';

    // -------- ROW 3 --------
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_2, GPIO_PIN_SET);
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_3, GPIO_PIN_RESET);
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0)) return 7;
    if (HAL_GPIO_ReadPin(GPIOE, GPIO_PIN_11)) return 8;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_2)) return 9;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_3)) return 'C';

    // -------- ROW 4 --------
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_3, GPIO_PIN_SET);
    HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_2, GPIO_PIN_RESET);
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0)) return '*';
    if (HAL_GPIO_ReadPin(GPIOE, GPIO_PIN_11)) return 0;
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_2)) return '#';
    if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_3)) return 'D';

    return -1;   // tuş yok
}

#define TEASPOON_GRAM 5.0f

void	SetTemperature			(  uint8_t   Temp	    ) ;
void	SetCoffy_Rate			(  uint8_t   rate  	    ) ;
void	SetSugar_Rate			(  uint8_t   rate   	) {};
void	SetWater_amount			(  uint16_t  amount 	) ;
void	SetMilk_amount  		(  uint16_t  amount     ) ;
void	SetCoffy_brewing_time	(  uint16_t  time	 	) {};
void	SetCoffy_foam_rate		(  uint8_t   foam       ) {};

uint16_t ReadTemperature		();

typedef struct{
    uint8_t  	Temperature;
    uint8_t  	Coffee_gram;
    uint16_t	Water_ml;
    uint16_t	Milk_ml;
    uint16_t 	Brew_time_sec;
}Coffy_Ingrediants;

typedef struct {
    uint8_t Sugar_gram;
    uint8_t Foam_rate;
} User_Settings_t;

void Coffy_Make( const  volatile Coffy_Ingrediants *Coffy , const  volatile User_Settings_t *user )
{
    SetTemperature			(  Coffy ->Temperature		 );
    SetCoffy_Rate			(  Coffy ->Coffee_gram  	 );
    SetWater_amount			(  Coffy ->Water_ml 		 );
    SetMilk_amount  		(  Coffy ->Milk_ml  		 );
    SetCoffy_brewing_time	(  Coffy ->Brew_time_sec	 );
    SetSugar_Rate			(user ->Sugar_gram   	 );
    SetCoffy_foam_rate		(user->Foam_rate);
}

typedef enum{
    COFFY_NONE ,
    TURK_KAHVESI,
    ESPRESSO,
    RISTRETTO,
    LUNGO,
    AMERICANO,
    LATTE,
    CARAMEL_LATTE,
    CAPPUCCINO,
    MOCHA,
    COFFY_NUMBER
}CoffyType_t;

typedef enum
{
    LEVEL_AZ = 0,
    LEVEL_ORTA,
    LEVEL_COK
} Level_t;

Level_t Sugar_Level = LEVEL_ORTA;
Level_t Foam_Level  = LEVEL_ORTA;

CoffyType_t selectedCoffee = COFFY_NONE;
int key;

volatile Coffy_Ingrediants Coffies[COFFY_NUMBER ] =  {
         [TURK_KAHVESI] = { .Temperature = 93, .Coffee_gram = 5, .Water_ml = 65, .Milk_ml = 0, .Brew_time_sec = 150 },
         [ESPRESSO] = { .Temperature = 92, .Coffee_gram = 8, .Water_ml = 30, .Milk_ml = 0, .Brew_time_sec = 25 },
         [RISTRETTO] = { .Temperature = 92, .Coffee_gram = 8, .Water_ml = 20, .Milk_ml = 0, .Brew_time_sec = 18 },
         [LUNGO] = { .Temperature = 92, .Coffee_gram = 8, .Water_ml = 60, .Milk_ml = 0, .Brew_time_sec = 40 },
         [AMERICANO] = { .Temperature = 92, .Coffee_gram = 10, .Water_ml = 110, .Milk_ml = 0, .Brew_time_sec = 25 },
         [LATTE] = { .Temperature = 65, .Coffee_gram = 5, .Water_ml = 30, .Milk_ml = 170, .Brew_time_sec = 25 },
         [CARAMEL_LATTE] = { .Temperature = 65, .Coffee_gram = 5, .Water_ml = 30, .Milk_ml = 170, .Brew_time_sec = 25 },
         [CAPPUCCINO] = { .Temperature = 65, .Coffee_gram = 8, .Water_ml = 30, .Milk_ml = 110, .Brew_time_sec = 25 },
         [MOCHA] = { .Temperature = 65, .Coffee_gram = 8, .Water_ml = 30, .Milk_ml = 130, .Brew_time_sec = 25 }
};

volatile User_Settings_t UserSettings = {
    .Sugar_gram = 0,
    .Foam_rate  = 50
};

uint8_t CoffeeGram_To_Bit(uint8_t gram)
{
    if 		(gram == 0)   return 0b00;
    else if (gram <= 3)   return 0b01;
    else if (gram <= 5)   return 0b10;
    else                  return 0b11;
}

void SetCoffy_Rate(uint8_t rate) {
    CoffyGramBit = CoffeeGram_To_Bit(rate);
    if (CoffyGramBit & 0x01) HAL_GPIO_WritePin(Coffy_Gram_LED1_GPIO_Port , Coffy_Gram_LED1_Pin, GPIO_PIN_SET);
    else HAL_GPIO_WritePin(Coffy_Gram_LED1_GPIO_Port , Coffy_Gram_LED1_Pin, GPIO_PIN_RESET);

    if (CoffyGramBit & 0x02) HAL_GPIO_WritePin(Coffy_Gram_LED2_GPIO_Port , Coffy_Gram_LED2_Pin, GPIO_PIN_SET);
    else HAL_GPIO_WritePin(Coffy_Gram_LED2_GPIO_Port , Coffy_Gram_LED2_Pin, GPIO_PIN_RESET);
}

uint8_t WaterMilim_To_Bit(uint16_t Water_Milim)
{
    if 		(Water_Milim == 0 )   return 0b00;
    else if (Water_Milim <= 30)   return 0b01;
    else if (Water_Milim <= 70)   return 0b10;
    else                  		  return 0b11;
}

void SetWater_amount(uint16_t Water_Milim) {
    WaterMilimBit = WaterMilim_To_Bit( Water_Milim);
    if (WaterMilimBit & 0x01) HAL_GPIO_WritePin(Water_Amount_LED1_GPIO_Port ,Water_Amount_LED1_Pin , GPIO_PIN_SET);
    else HAL_GPIO_WritePin(Water_Amount_LED1_GPIO_Port ,Water_Amount_LED1_Pin , GPIO_PIN_RESET);

    if (WaterMilimBit & 0x02) HAL_GPIO_WritePin(Water_Amount_LED2_GPIO_Port ,Water_Amount_LED2_Pin, GPIO_PIN_SET);
    else HAL_GPIO_WritePin(Water_Amount_LED2_GPIO_Port ,Water_Amount_LED2_Pin, GPIO_PIN_RESET);
}

uint8_t MilkMilim_To_Bit(  uint16_t  Milk_Milim     )
{
    if 		(Milk_Milim == 0 )   return 0b00;
    else if (Milk_Milim <= 30)   return 0b01;
    else if (Milk_Milim <= 70)   return 0b10;
    else                  		 return 0b11;
}

void SetMilk_amount(uint16_t Milk_Milim) {
    MilkMilimBit = MilkMilim_To_Bit( Milk_Milim);
    if (MilkMilimBit & 0x01) HAL_GPIO_WritePin(Milk_Amount_LED1_GPIO_Port ,Milk_Amount_LED1_Pin , GPIO_PIN_SET);
    else HAL_GPIO_WritePin(Milk_Amount_LED1_GPIO_Port ,Milk_Amount_LED1_Pin , GPIO_PIN_RESET);

    if (MilkMilimBit & 0x02) HAL_GPIO_WritePin(Milk_Amount_LED2_GPIO_Port ,Milk_Amount_LED2_Pin, GPIO_PIN_SET);
    else HAL_GPIO_WritePin(Milk_Amount_LED2_GPIO_Port ,Milk_Amount_LED2_Pin, GPIO_PIN_RESET);
}

uint16_t ReadTemperature(void)
{
    uint32_t sum = 0;
    uint16_t adcValue;
    for (int i = 0; i < 8; i++)
    {
        HAL_ADC_Start(&hadc1);
        HAL_ADC_PollForConversion(&hadc1, 10);
        adcValue = HAL_ADC_GetValue(&hadc1);
        HAL_ADC_Stop(&hadc1);
        sum += adcValue;
        HAL_Delay(2);
    }
    adcValue = sum / 8;
    currentTemp = (adcValue * 105) / 4095;
    return currentTemp;
}

int a= 0;

void SetTemperature(uint8_t targetTemp){
    __HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, currentTemp);

    if  (currentTemp > targetTemp + 5){
        if (HAL_GetTick() - ledTimer >= 500)
        {
            HAL_GPIO_TogglePin(Temperature_Warning_LED2_GPIO_Port, Temperature_Warning_LED2_Pin);
            HAL_GPIO_WritePin (Temperature_Ready_LED1_GPIO_Port   ,  Temperature_Ready_LED1_Pin, GPIO_PIN_RESET);
            ledTimer = HAL_GetTick();
        }
    }
    else if(currentTemp >= (targetTemp - 5)  && currentTemp <= (targetTemp + 5)  ){
                HAL_GPIO_WritePin (Temperature_Ready_LED1_GPIO_Port   ,  Temperature_Ready_LED1_Pin, GPIO_PIN_SET);
                HAL_GPIO_WritePin  (Temperature_Warning_LED2_GPIO_Port ,  Temperature_Warning_LED2_Pin, GPIO_PIN_RESET);
    }
    else if (currentTemp <= targetTemp ){
        HAL_GPIO_WritePin(Temperature_Ready_LED1_GPIO_Port, Temperature_Ready_LED1_Pin, GPIO_PIN_RESET );
    }
}

// ------ DÜZENLENMİŞ AYAR FONKSİYONLARI (LCD EKLENDİ) ------

void Sugar_Adjust(int key)
{
    if (key == 'A' || key == 'B')
    {
        if (key == 'A' && Sugar_Level < LEVEL_COK) Sugar_Level++;
        else if (key == 'B' && Sugar_Level > LEVEL_AZ) Sugar_Level--;

        // LCD Güncelleme
        lcd_clear();
        lcd_put_cur(0, 0);
        lcd_send_string("Seker Ayari:");
        lcd_put_cur(1, 0);
        lcd_send_string(LevelNames[Sugar_Level]);
        HAL_Delay(200); // Debounce
    }
}

void Foam_Adjust(int key)
{
    if (key == 'C' || key == 'D')
    {
        if (key == 'C' && Foam_Level < LEVEL_COK) Foam_Level++;
        else if (key == 'D' && Foam_Level > LEVEL_AZ) Foam_Level--;

        // LCD Güncelleme
        lcd_clear();
        lcd_put_cur(0, 0);
        lcd_send_string("Kopuk Ayari:");
        lcd_put_cur(1, 0);
        lcd_send_string(LevelNames[Foam_Level]);
        HAL_Delay(200); // Debounce
    }
}

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{
  HAL_Init();
  SystemClock_Config();
  MX_GPIO_Init();
  MX_ADC1_Init();
  MX_TIM2_Init();
  MX_I2C1_Init();

  /* USER CODE BEGIN 2 */
  HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_1);

  // LCD Başlangıç
  lcd_init();
  lcd_clear();
  lcd_put_cur(0, 2);
  lcd_send_string("KAHVE MAKINESI");
  lcd_put_cur(1, 2);
  lcd_send_string("Hosgeldiniz...");
  HAL_Delay(2000); // 2 saniye bekle

  lcd_clear();
  lcd_put_cur(0, 0);
  lcd_send_string("Kahve Seciniz");
  /* USER CODE END 2 */

  /* Infinite loop */
  while (1)
  {
    currentTemp = ReadTemperature();
    SetTemperature(Coffies[selectedCoffee].Temperature);

    key = Keyboard_Read();

    // A, B, C, D tuşlarına basıldığında (Ayar menüsü)
    if(key == 'A' || key == 'B') Sugar_Adjust(key);
    if(key == 'C' || key == 'D') Foam_Adjust(key);

    // 1-9 arası kahve seçimi
    if (key >= 1 && key <= 9)
    {
        selectedCoffee = (CoffyType_t)key;

        // 1. ADIM: "Hazirlaniyor..." Ekrani
        lcd_clear();
        lcd_put_cur(0, 0);
        lcd_send_string(CoffeeNames[selectedCoffee]);
        lcd_put_cur(1, 0);
        lcd_send_string("Hazirlaniyor...");
        HAL_Delay(3000);

        // Kahve Yapım İşlemi (LED'ler, süreler vs.)
        Coffy_Make(&Coffies[selectedCoffee], &UserSettings);
        HAL_Delay(3000); // Kahve hazırlanma süresi simülasyonu

        // 2. ADIM: Şeker ve Köpük Bilgisi (İsteğiniz üzerine buraya eklendi)
        lcd_clear();
        lcd_put_cur(0, 0);
        lcd_send_string("Seker: ");
        lcd_send_string(LevelNames[Sugar_Level]); // Örn: Seker: ORTA

        lcd_put_cur(1, 0);
        lcd_send_string("Kopuk: ");
        lcd_send_string(LevelNames[Foam_Level]); // Örn: Kopuk: AZ
        HAL_Delay(3500); // Kullanıcının okuması için 2.5 sn bekle

        // 3. ADIM: Bitti Mesajı
        lcd_clear();
        lcd_put_cur(0, 0);
        lcd_send_string(CoffeeNames[selectedCoffee]);
        lcd_put_cur(1, 0);
        lcd_send_string("Hazir! Afiyetle");
        HAL_Delay(3000);

        // Ana Ekrana Dönüş
        lcd_clear();
        lcd_put_cur(0, 0);
        lcd_send_string("Kahve Seciniz");
    }

    HAL_Delay(50);
  }
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  __HAL_RCC_PWR_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);

  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSI;
  RCC_OscInitStruct.PLL.PLLM = 8;
  RCC_OscInitStruct.PLL.PLLN = 50;
  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV4;
  RCC_OscInitStruct.PLL.PLLQ = 7;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV4;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)
  {
    Error_Handler();
  }
}

static void MX_ADC1_Init(void)
{
  ADC_ChannelConfTypeDef sConfig = {0};
  hadc1.Instance = ADC1;
  hadc1.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV2;
  hadc1.Init.Resolution = ADC_RESOLUTION_12B;
  hadc1.Init.ScanConvMode = ENABLE;
  hadc1.Init.ContinuousConvMode = DISABLE;
  hadc1.Init.DiscontinuousConvMode = DISABLE;
  hadc1.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
  hadc1.Init.ExternalTrigConv = ADC_SOFTWARE_START;
  hadc1.Init.DataAlign = ADC_DATAALIGN_RIGHT;
  hadc1.Init.NbrOfConversion = 1;
  hadc1.Init.DMAContinuousRequests = DISABLE;
  hadc1.Init.EOCSelection = ADC_EOC_SINGLE_CONV;
  if (HAL_ADC_Init(&hadc1) != HAL_OK)
  {
    Error_Handler();
  }
  sConfig.Channel = ADC_CHANNEL_1;
  sConfig.Rank = 1;
  sConfig.SamplingTime = ADC_SAMPLETIME_3CYCLES;
  if (HAL_ADC_ConfigChannel(&hadc1, &sConfig) != HAL_OK)
  {
    Error_Handler();
  }
}

static void MX_I2C1_Init(void)
{
  hi2c1.Instance = I2C1;
  hi2c1.Init.ClockSpeed = 100000;
  hi2c1.Init.DutyCycle = I2C_DUTYCYCLE_2;
  hi2c1.Init.OwnAddress1 = 0;
  hi2c1.Init.AddressingMode = I2C_ADDRESSINGMODE_7BIT;
  hi2c1.Init.DualAddressMode = I2C_DUALADDRESS_DISABLE;
  hi2c1.Init.OwnAddress2 = 0;
  hi2c1.Init.GeneralCallMode = I2C_GENERALCALL_DISABLE;
  hi2c1.Init.NoStretchMode = I2C_NOSTRETCH_DISABLE;
  if (HAL_I2C_Init(&hi2c1) != HAL_OK)
  {
    Error_Handler();
  }
}

static void MX_TIM2_Init(void)
{
  TIM_MasterConfigTypeDef sMasterConfig = {0};
  TIM_OC_InitTypeDef sConfigOC = {0};
  htim2.Instance = TIM2;
  htim2.Init.Prescaler = 999;
  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim2.Init.Period = 249;
  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_PWM_Init(&htim2) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim2, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sConfigOC.OCMode = TIM_OCMODE_PWM1;
  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  if (HAL_TIM_PWM_ConfigChannel(&htim2, &sConfigOC, TIM_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  HAL_TIM_MspPostInit(&htim2);
}

static void MX_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};

  __HAL_RCC_GPIOC_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();
  __HAL_RCC_GPIOE_CLK_ENABLE();

  HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_2|GPIO_PIN_3
                          |Coffy_Gram_Flag_Pin|Coffy_Gram_LED1_Pin, GPIO_PIN_RESET);
  HAL_GPIO_WritePin(GPIOA, Temperature_Flag_Pin|Temperature_Ready_LED1_Pin|Temperature_Warning_LED2_Pin, GPIO_PIN_RESET);
  HAL_GPIO_WritePin(GPIOB, Coffy_Gram_LED2_Pin|Water_Amount_Flag_Pin|Water_Amount_LED1_Pin, GPIO_PIN_RESET);
  HAL_GPIO_WritePin(GPIOE, Water_Amount_LED2_Pin|Milk_Amount_Flag_Pin|Milk_Amount_LED1_Pin|Milk_Amount_LED2_Pin, GPIO_PIN_RESET);

  GPIO_InitStruct.Pin = GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_2|GPIO_PIN_3
                          |Coffy_Gram_Flag_Pin|Coffy_Gram_LED1_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

  GPIO_InitStruct.Pin = GPIO_PIN_0|GPIO_PIN_2|GPIO_PIN_3;
  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  GPIO_InitStruct.Pull = GPIO_PULLDOWN;
  HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

  GPIO_InitStruct.Pin = Temperature_Flag_Pin|Temperature_Ready_LED1_Pin|Temperature_Warning_LED2_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

  GPIO_InitStruct.Pin = Coffy_Gram_LED2_Pin|Water_Amount_Flag_Pin|Water_Amount_LED1_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);

  GPIO_InitStruct.Pin = Water_Amount_LED2_Pin|Milk_Amount_Flag_Pin|Milk_Amount_LED1_Pin|Milk_Amount_LED2_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOE, &GPIO_InitStruct);

  GPIO_InitStruct.Pin = GPIO_PIN_11;
  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  GPIO_InitStruct.Pull = GPIO_PULLDOWN;
  HAL_GPIO_Init(GPIOE, &GPIO_InitStruct);
}

void Error_Handler(void)
{
  __disable_irq();
  while (1)
  {
  }
}
#ifdef USE_FULL_ASSERT
void assert_failed(uint8_t *file, uint32_t line)
{
}
#endif
